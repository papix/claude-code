# Claude Code グローバル設定

## 基本設定

### 言語設定
- 常に日本語で応答してください

### 知識管理の方針
- **変わりうる知識は記載しない**: 技術は常に進化するため、都度最新の情報を調べる方針とする
  - 記載しないもの: ベストプラクティス、デファクトスタンダード、業界標準、推奨される方法など
  - 記載するもの: プロジェクト固有の決定事項、採用した具体的な方法、実装時の理由
  - 避ける表現: 「推奨」「ベストプラクティス」「デファクトスタンダード」「一般的に」「標準的な」
  - 必要な時は`gemini-search`等で最新の情報を検索して対応

### 実装前の調査提案
- **積極的に最新情報の調査を提案**: 実装・設計・調査・検討時は、まず最新の情報を調べることを提案
  - 新機能実装前: 「この機能の実装について、最新のベストプラクティスを調べますか？」
  - 技術選定時: 「現在のデファクトスタンダードを確認してから進めますか？」
  - 設計検討時: 「最新の設計パターンや実装例を調査しますか？」
  - パフォーマンス改善時: 「最新の最適化手法を調べてから実装しますか？」
  - セキュリティ実装時: 「現在のセキュリティベストプラクティスを確認しますか？」

### タスク実行における確認方針
- **指示の妥当性確認**: ユーザーの指示が以下に該当する場合は、必ず実行前に確認を取ってください
  - 技術的に不適切または非推奨な方法の場合
  - より良い代替案が存在する場合
  - 指示に矛盾や問題がある場合
  - セキュリティやパフォーマンスのリスクがある場合
- **不明点の確認**: タスクの指示や要件に不明な点がある場合は、推測で進めず必ず確認してください
- **前提条件の確認**: 以下の場合は実行前に必ず確認を取ってください
  - 大規模な変更や削除を伴う場合
  - 既存の実装パターンから大きく逸脱する場合
  - 複数の実装方法があり、選択が必要な場合
  - セキュリティやパフォーマンスに影響する可能性がある場合
- **仕様の明確化**: あいまいな要求や複数の解釈が可能な指示の場合は、具体的な仕様を確認してください
- **影響範囲の確認**: 変更が他の機能に影響する可能性がある場合は、その影響範囲を説明し確認を取ってください

### ライブラリ管理の確認方針
- **新規ライブラリ追加時の確認**: ライブラリを追加しようとする際は、必ず以下を確認してください
  - プロジェクトに類似機能のライブラリが既に存在しないか検査
  - 類似ライブラリが存在する場合は、以下の選択肢を提示：
    1. 既存のライブラリを使用する（推奨）
    2. 新しいライブラリに置き換える（理由を明確に説明）
    3. 両方を併用する（特別な理由がある場合のみ）
  - 確認例：
    ```
    日付処理のために date-fns を追加しようとしていますが、
    プロジェクトには既に dayjs がインストールされています。
    
    どちらを使用しますか？
    1. 既存の dayjs を使用する
    2. date-fns を新規追加する（理由：〇〇）
    ```

## コマンドドキュメント規約

### commandsディレクトリのドキュメント
- `~/.claude/commands/`内のMarkdownファイルは以下のルールで記述
  - **h1タイトル（#）は英語でコマンドの概要を記述**
  - **それ以外（説明文、使用例、h2以降の見出しなど）は日本語で記述**
  - 例：
    ```markdown
    # Smart Rebase - Intelligent rebase helper  ← 英語で概要を含む
    
    指定したブランチをrebaseします。 ← 日本語
    
    ## 使用方法  ← 日本語
    ```

## 開発ワークフロー

### Git コミット規約
- **コミット単位**: 巨大な1つのコミットではなく、意味のある単位で細かく分割してコミット
  - 型定義やスキーマ変更
  - ビジネスロジック（サービス/トランザクション層）の実装
  - Server Actions の追加・変更
  - UIコンポーネントの実装・変更
  - ページ統合や最終的な接続
  - 各コミットは独立して意味を持ち、後から見て変更内容が理解できる単位にする
- **自動コミット**: 各実装単位が完了したら、自動的に `git add` と `git commit` を実行
  - コミット前に必ずlint/formatのコマンドがあれば実行し、エラーがないことを確認
  - エラーがある場合は修正してからコミット
- **ブランチ確認**: コミット前に必ず現在のブランチを確認
  - 想定外のブランチの場合はユーザーに確認を取る
- **変更内容確認**: `git diff --staged` で変更内容を確認してからコミット
- **コミットメッセージ**:
  - 1行目: 変更の種類と概要（feat/fix/refactor/style/docs/test/chore）
  - 2行目: 空行
  - 3行目以降: 詳細な変更内容（箇条書き）

### タスク管理
- タスクは複数のフェイズに分けて実行
- 各フェイズ完了時に適切にコミット
- commit後の修正依頼は、1つのcommitにまとめる

### 品質管理
- タスク完了後は、プロジェクトのlint/format設定を必ず実行
- 例: `npm run lint`, `npm run format`, `npm run typecheck`

### 問題解決
- 技術的な問題、不明点、エラーは `gemini-search` で検索

### 情報源の提示方針
- **ベストプラクティスやデファクトスタンダードを調査した場合**:
  - 必ず根拠となるソースのURLを提示
  - 複数のソースがある場合は、信頼性の高い公式ドキュメントを優先
  - 英語のソースと日本語のソースの両方を提示（存在する場合）
  - 提示形式の例:
    ```
    参考資料:
    - [英語] React公式ドキュメント: https://react.dev/learn/...
    - [日本語] React日本語ドキュメント: https://ja.react.dev/learn/...
    - [英語] MDN Web Docs: https://developer.mozilla.org/en-US/docs/...
    - [日本語] MDN Web Docs (日本語版): https://developer.mozilla.org/ja/docs/...
    ```
  - 信頼できる情報源の優先順位:
    1. 公式ドキュメント（各技術の公式サイト）
    2. MDN Web Docs
    3. 大手技術企業の技術ブログ（Google、Microsoft、Meta等）
    4. 信頼できる技術コミュニティ（Stack Overflow、Zenn、Qiita等）

### 実装パターンの踏襲と改善
- 新機能実装時は、必ず類似する既存機能の実装を確認し、同じパターンで実装
- ただし、既存実装より良い方法がある場合は必ず提案し、改善案を採用
- 改善案を採用する場合は、その理由を明確に説明
- 提案時は変わりうる知識（ベストプラクティス、デファクトスタンダード等）に頼らず、具体的なメリット・デメリットを説明

## コーディング規約

### TypeScript
- `any` 型の使用禁止
- `const` を優先使用（`let` は最小限）
- **インポートパス**: 必ずパスエイリアス（`@/`）を使用
  - 相対パス（`../../`）は使用禁止
  - 例: `import { Component } from '@/components/Component'`
- 型定義は `types/` ディレクトリに整理
- 状態の型定義は const type として定義

### 非同期処理とUI状態管理
- 重複実行防止のガード処理を実装
- 状態管理: `idle`, `loading`, `success`, `error`
- エラー時は適切な状態に戻し、再試行可能に
- 処理中はボタン無効化と視覚的フィードバック

### リファクタリング
- コミットをまとめる: `git reset --soft HEAD~n`
- ファイル名変更: `git mv` で履歴保持
- 型定義移動時は全参照元を更新

### エラーハンドリング
- **Next.js 15のエラー関数を活用**
  - `notFound()` - 404エラー（リソースが見つからない場合）
  - `forbidden()` - 403エラー（権限不足の場合）
  - `redirect()` - リダイレクト（エラー時は避ける）
- **適切なHTTPステータスコード**
  - エラー時は適切なステータスコードを返す
  - SEOとユーザビリティを考慮
- **ユーザーフレンドリーなエラーページ**
  - エラーの理由を明確に説明
  - 次のアクションを提示（ホームへ戻る、ログインなど）

### パフォーマンス最適化
- **並列処理の活用**
  - 独立した非同期処理は`Promise.all`で並列実行
  - 特にServer Componentでのデータ取得で重要
  - 依存関係がある場合のみ順次実行
  ```typescript
  // 並列実行の例
  const [data1, data2, data3] = await Promise.all([
    service1.getData(),
    service2.getData(),
    service3.getData()
  ])
  ```
- **不要な抽象化を避ける**
  - 読み取り専用操作はサービスを直接呼び出し
  - Server Actionsは副作用を伴う操作のみ

### ドキュメント管理
- **ドキュメント構造**
  - プロジェクトルートに`docs/`ディレクトリを作成
  - カテゴリ別にサブディレクトリを整理（api/、guides/、development/）
  - READMEで全体の構成を説明
- **ドキュメント更新のタイミング**
  - 新機能実装時に同時にドキュメント作成
  - APIエンドポイント追加時は必ず仕様を記載
  - 実装とドキュメントの乖離を防ぐ

## コードレビューガイド

### 実装完了時の出力
実装が完了したら、以下の情報を出力してレビューを支援：

- **重点確認ファイル**: 変更の核となるファイルリスト
  - ビジネスロジックの変更点
  - 新規追加された主要機能
  - 既存機能への影響が大きい変更
- **レビュー観点**:
  - 型安全性: 新規追加された型定義、any型の使用有無
  - エラーハンドリング: 例外処理、エラー状態の管理
  - パフォーマンス: N+1問題、不要な再レンダリング
  - セキュリティ: 認証・認可、入力検証
  - 設計パターン: 既存パターンとの整合性
- **テスト確認事項**:
  - 追加・変更が必要なテストケース
  - E2Eテストで確認すべきシナリオ
- **動作確認手順**: 実装した機能の確認方法

## 備考
このファイルは全プロジェクト共通の設定です。
プロジェクト固有の設定は各プロジェクトの `CLAUDE.md` に記載してください。