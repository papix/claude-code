# Extract and document learnings from development

このコマンドは、開発中に得られた知見を適切な CLAUDE.md ファイルに反映させるためのヘルパーです。

## 使用方法

```
/claude-learnings [トピック]
```

### 基本使用
```bash
# 全般的な知見を更新
/claude-learnings

# 特定のトピックに関する知見を更新
/claude-learnings "API実装パターン"
/claude-learnings "エラーハンドリング"
/claude-learnings "パフォーマンス最適化"
```

### 複数トピックの指定
```bash
# カンマ区切りで複数指定
/claude-learnings "API実装, 認証パターン, エラーハンドリング"
```

### オプション
- `--focus <topic>` - 特定のトピックに焦点を当てる
- `--recent` - 直近の変更のみから知見を抽出（デフォルト）
- `--all` - プロジェクト全体から知見を抽出

開発中に新しい知見や重要な情報を発見した場合、このコマンドを実行してください：
- プロジェクト固有の知見 → リポジトリの CLAUDE.md
- 汎用的な知見 → ~/.claude/CLAUDE.md

## 実行手順

1. **コマンド引数の解析**
   - トピックが指定されている場合は、そのトピックを記録
   - 複数トピックの場合は、カンマで分割してリスト化

2. **作業ディレクトリの確認**
   - 現在の作業ディレクトリがGitリポジトリ内かを確認
   - リポジトリ外の場合は「Gitリポジトリ内で実行してください」と通知して終了

3. **知見の収集**
   - **トピック指定あり**: 指定されたトピックに関連する情報を重点的に検索
     - 関連するファイルやコミットメッセージを検索
     - トピックに関連する実装パターンを抽出
     - 既存のCLAUDE.mdから関連セクションを確認
     - 検索方法の例：
       - "API実装" → `api/`ディレクトリ、`*.api.ts`、`route.ts`ファイル
       - "エラーハンドリング" → try-catch、error関数、エラーページ
       - "認証" → auth関連ファイル、middleware、session処理
   - **トピック指定なし**: 最近の変更内容や実装パターンを全般的に分析

4. **知見の分類と追記**
   - プロジェクト固有の知見と汎用的な知見を分類
   - それぞれ適切なCLAUDE.mdファイルに追記提案
   - トピック指定がある場合は、該当セクションに優先的に追記

## 知見の分類基準

### プロジェクト固有の知見（リポジトリの CLAUDE.md へ）
- アプリケーション固有の設計パターン
- プロジェクト特有の開発フロー
- 環境固有の設定や制約
- ドメイン固有のビジネスロジック
- プロジェクト固有のコマンドやスクリプト

### 汎用的な知見（~/.claude/CLAUDE.md へ）
- プロジェクト横断で使える具体的な実装パターン
- 実際に解決した問題とその対処法
- エラーハンドリングの具体的な実装例
- 特定のツールやライブラリの使い方
- **注意**: 変わりうる知識は記載しない
  - NG: ベストプラクティス、デファクトスタンダード、業界標準、一般的な方法
  - OK: 具体的な実装例、実際に採用した方法とその理由

## 追記時の注意事項

1. 既存の内容と重複しないよう確認
2. 適切なセクションに追記（なければ新規作成）
3. 具体例を含めて記載
4. 簡潔で実用的な内容にする
5. 将来の自分や他の開発者が理解できる記述
6. **変わりうる知識は記載しない** - 技術は常に進化するため、都度最新の情報を調べる方針とする
   - NG例: 
     - "〜がベストプラクティスです"
     - "〜が推奨されています"
     - "〜がデファクトスタンダードです"
     - "一般的には〜します"
     - "標準的な方法は〜"
   - OK例: 
     - "このプロジェクトでは〜の方法を採用"
     - "〜の理由で〜を使用"
     - "〜の問題を解決するため〜を実装"
     - "試した結果、〜が効果的だった"

## よくある使用シーン

### 新機能実装後
```bash
# APIエンドポイントの実装パターンを記録
/claude-learnings "APIエンドポイント実装"

# 認証機能の実装パターンを記録
/claude-learnings "認証実装, JWT, OAuth"
```

### バグ修正後
```bash
# エラーハンドリングの改善点を記録
/claude-learnings "エラーハンドリング, バリデーション"

# パフォーマンス問題の解決法を記録
/claude-learnings "パフォーマンス最適化, クエリ最適化"
```

### リファクタリング後
```bash
# コード構造の改善パターンを記録
/claude-learnings "コード構造, リファクタリング"

# テスト性向上の工夫を記録
/claude-learnings "テストパターン, モック化"
```

## 関連コマンド

- `/claude-config` - 設定ファイルの直接編集
- `/code-review` - コードレビューで得た知見の元
- `/task` - 実装タスクの計画と実行

## エラーハンドリング

- **Gitリポジトリ外での実行**: エラーメッセージを表示して終了
- **ファイルが見つからない**: 関連ファイルの検索方法を提案
- **知見が抽出できない**: より具体的なトピックの指定を依頼

## 実行例

### 全般的な更新
```bash
# プロジェクトディレクトリ内で実行
cd /path/to/your/project
/claude-learnings
# → 最近の実装から知見を抽出して提案
```

### 特定トピックの更新
```bash
# API実装に関する知見を更新
/claude-learnings "API実装パターン"
# → API関連のファイルや実装を重点的に分析

# エラーハンドリングの知見を更新
/claude-learnings "エラーハンドリング"
# → エラー処理やtry-catchパターンを検索・分析

# 複数トピックを同時に更新
/claude-learnings "認証実装, セキュリティ, APIキー管理"
# → 指定された全トピックに関する知見を収集
```

### 使用シーン例
- **新機能実装後**: その機能の実装パターンを記録
  ```bash
  /claude-learnings "APIエンドポイント実装"
  ```
- **バグ修正後**: エラーハンドリングや注意点を記録
  ```bash
  /claude-learnings "エラーハンドリング, バリデーション"
  ```
- **リファクタリング後**: 改善されたパターンを記録
  ```bash
  /claude-learnings "パフォーマンス最適化, コード構造"
  ```

実装した新しいパターンや解決した課題から、再利用可能な知見を抽出して適切なCLAUDE.mdファイルに反映させましょう。

## 注意事項
- 変わりうる知識（ベストプラクティス等）は記載しない
- 具体的な実装例や実際に採用した方法を記録
- プロジェクト固有の知見と汎用的な知見を適切に分類