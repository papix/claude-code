# Generate task implementation prompt

## 概要
新規タスクまたは既存作業の再実行のためのプロンプトを生成します。実作業を開始する前に、明確な実装計画を立てます。

## 使用方法
```
/task [--redo] <タスクの説明>
```
- `--redo`: 現在のブランチの作業を参考にして再実装（オプション）

## 実行内容
1. **Gitブランチの確認**
   - Gitリポジトリ内の場合は、現在のブランチを確認
   - 現在のブランチ名を表示
   - mainブランチにいる場合は、新しいブランチ名の候補を提案
   - 既に機能ブランチにいる場合は：
     - 現在のブランチで作業を継続するオプションを明示
     - 新しいブランチに切り替えるオプションも提示

2. **タスクの分析**
   - タスク内容の理解と確認
   - 必要な情報の質問
   - `--redo`の場合: 現在のブランチの作業内容を分析

3. **質問フェーズ（重要）**
   - プロンプト生成に必要な情報が不足している場合は、ユーザーに質問
   - 以下のような観点で質問を行う：
     - 実装の詳細仕様（UIの詳細、データ構造、APIの仕様など）
     - 技術的な制約や要件（パフォーマンス要件、既存システムとの連携など）
     - 優先順位や実装範囲の確認
     - エラーハンドリングやエッジケースの扱い
   - **重要**: 質問への回答を得た後は、実装を開始せず、得られた情報を踏まえて改めてプロンプトを生成して提示

4. **実装計画の作成**
   - 実装手順の整理
   - 技術的な考慮事項の洗い出し
   - リスクと課題の特定

5. **ブランチ戦略の提案**
   - 現在のブランチがmainの場合：
     - 命名規則に従った複数のブランチ名候補を提示
     - 例: `feature/`, `fix/`, `refactor/`, `chore/`
   - 既に機能ブランチにいる場合：
     - 現在のブランチで継続（デフォルト推奨）
     - 新規ブランチへの切り替えオプション

6. **プロンプトの生成**
   - 実装に必要な全情報を含む詳細なプロンプト
   - ステップバイステップの実装手順
   - **質問への回答が得られた場合は、その内容を反映した完全なプロンプトを生成**

7. **実装確認の待機**
   - プロンプトと実装計画を提示後、ユーザーからの明示的な実装指示を待つ
   - 「実装してください」等の明確な指示があるまでは実装を開始しない
   - **実装開始時に、選択されたブランチ名（またはデフォルト）で実際にブランチを作成**

## 出力形式

### 質問がある場合の出力
```
## 🤔 実装に関する質問

タスクを正確に理解し、適切なプロンプトを生成するために、以下の点について確認させてください：

### 質問事項
1. **[質問カテゴリ1]**
   - 具体的な質問内容
   - なぜこの情報が必要か

2. **[質問カテゴリ2]**
   - 具体的な質問内容
   - デフォルトの想定がある場合はその内容

### 回答後の流れ
ご回答いただいた内容を踏まえて、改めて完全なプロンプトを生成して提示します。
その時点では実装は開始せず、プロンプトの確認をお願いします。
```

### プロンプト生成時の出力
```
## 📝 タスク実行プロンプト

### タスク概要
[タスクの内容を簡潔に説明]

### 現在のブランチ
現在のブランチ: `[current-branch-name]`

### 質問への回答に基づく仕様（質問があった場合）
- [回答1に基づく仕様]
- [回答2に基づく仕様]

### 現在の状況分析（--redoの場合）
- 実装済みの機能: [...]
- 改善点: [...]
- 参考にすべき実装: [...]

### 実装計画
1. [ステップ1の詳細]
2. [ステップ2の詳細]
3. ...

### 技術的考慮事項
- [考慮事項1]
- [考慮事項2]

### 推奨ブランチ名候補
[mainブランチの場合]
以下のブランチ名から選択するか、カスタム名を指定してください：

1. `feature/implement-xxx-functionality` （推奨）
2. `feature/add-xxx-feature`
3. `fix/resolve-xxx-issue`

[既存の機能ブランチの場合]
現在のブランチ: `feature/existing-branch`

0. **現在のブランチで継続** （推奨）
1. `feature/implement-xxx-functionality` 
2. `feature/add-xxx-feature`

### 詳細プロンプト
以下のプロンプトを使用して実装を開始します：

---
[ここに詳細な実装プロンプトを記載]
---

### 実装開始の確認
この実装計画でよろしければ、以下のいずれかをお答えください：

[既存ブランチの場合]
- 「実装してください」または「続けてください」（現在のブランチで継続）
- 「新しいブランチで実装してください」（推奨ブランチ名 #1 を使用）
- 「2番で実装してください」（ブランチ名候補 #2 を使用）

[mainブランチの場合]
- 「実装してください」（推奨ブランチ名 #1 を使用）
- 「2番で実装してください」（ブランチ名候補 #2 を使用）
- 「`feature/custom-name`で実装してください」（カスタムブランチ名を使用）

実装開始時に選択されたブランチを作成し、作業を開始します。
```

## よくある使用シーン

### 新機能の実装開始時
```bash
# 新しい機能の実装計画を立てる
/task ユーザー認証機能を実装してください

# 複雑な機能の場合、詳細を含めて指定
/task OAuth2.0とJWT を使った認証システムを実装。Google/GitHub連携も含む
```

### リファクタリング作業
```bash
# 既存コードの改善計画
/task APIエンドポイントのエラーハンドリングを統一的にリファクタリング

# パフォーマンス改善
/task データベースクエリの最適化とN+1問題の解決
```

### バグ修正
```bash
# バグ修正の計画立案
/task ユーザー登録時のメール送信が失敗する問題を修正

# 再現が難しいバグへの対応
/task 特定条件下でのメモリリークを調査・修正
```

### 既存作業のやり直し
```bash
# より良い実装でやり直し
/task --redo より良いエラーハンドリングで再実装

# アーキテクチャを考慮した再実装
/task --redo Clean Architectureパターンに基づいて再設計
```

## 例

### 新規タスクの場合
```
/task ユーザー認証機能を実装してください
```

### 既存作業の再実行の場合
```
/task --redo より良いエラーハンドリングで再実装
```

## 関連コマンド

- `/code-review` - 実装後のコードレビュー
- `/claude-learnings` - 実装で得た知見の記録
- `/squash-commits` - 実装完了後のコミット整理
- `/smart-rebase` - 最新のmainブランチとの同期

## 注意事項
- **現在のブランチでの継続**: 既に機能ブランチにいる場合は、デフォルトで現在のブランチでの作業継続を推奨
- **ブランチ切り替えの明示**: 新しいブランチが必要な場合は、明示的に指定が必要
- **ブランチ作成のタイミング**: ブランチ名の候補は提示するが、実際の作成は実装開始時に行う
- **実作業の禁止**: プロンプト生成が完了するまで、実装や調査などの実作業は行わない
- **実装開始の制限**: プロンプト生成後も、ユーザーからの明示的な実装指示があるまでは実装を開始しない
- **情報収集**: 不明な点は積極的に質問して、完全な理解を得てからプロンプトを生成
- **ブランチ戦略**: mainブランチから新規ブランチを作成することを推奨
- **プロンプトの詳細度**: 他の開発者（または将来の自分）が理解できる詳細さを保つ
- **実装開始の条件**: 以下のような明示的な指示があった場合のみ実装を開始
  - 「実装してください」または「続けてください」（既存ブランチの場合は継続、mainの場合は新規ブランチ）
  - 「新しいブランチで実装してください」（既存ブランチから新規ブランチへ）
  - 「2番で実装してください」（指定された番号のブランチ名を使用）
  - 「`branch-name`で実装してください」（カスタムブランチ名を使用）
  - その他、明確に実装を指示する表現
- **ブランチ作成時の動作**:
  - 実装指示を受けたら、必要に応じてブランチを作成
  - 既存ブランチで継続の場合は、ブランチ作成はスキップ
  - 既存のブランチ名と衝突する場合は、番号を付けて調整